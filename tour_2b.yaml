id: tour-2b
name: Tour 2b
description: Alignment of sequence reads against a reference genome using STAR
title_default: Tour 2b
steps:
  - title: '<b>Outline</b>'
    element: ''
    content: 'In this tour, we will align sequence reads against a reference genome. This represents a necessary task for the quantification and estimation of gene expression, because it provides a mapping between the processed reads and a reference genome, which can be later used in conjunction with statistical methods to evaluate transcript abundance.<br />
Here, we will leverage on <b>STAR</b>, an ultrafast and low error rate RNA-Seq aligner.<br /><br />
Click <b>Next</b> to start the analysis.<br />'
    backdrop: true

  - title: '<b>Import the reference genome</b>'
    element: ''
    content: 'In this analysis step, we need to align and map the processed reads against a reference genome.<br /><br />
<b>TODO: more on the analysis</b>.<br /><br />
Click <b>Next</b> to start the analysis.<br />'

  - title: '<b>Import the reference genome</b>'
    element: '#tool-panel-upload-button .fa.fa-upload'
    content: 'The import button imports data into Galaxy.<br /><br />
Click <b>Next</b> to import your data and start the analysis.<br />'
    placement: right
    postclick:
      - '.upload-button'

  - title: '<b>Import the reference genome</b>'
    element: '.upload-text-content:last'
    content: 'Data can be imported from the local machine, as well as from diverse online resources.<br /><br />
Click <b>Next</b> to import the reference genome and gene model from <a href="https://zenodo.org/" target="_blank">Zenodo</a>.<br />'
    placement: right
    preclick:
      - '.upload-button'
      - '#btn-new'
    textinsert: |
      https://zenodo.org/api/files/24933283-642a-4ee9-802a-6e7e03afb877/Saccharomyces_cerevisiae_BK006934.fna
      https://zenodo.org/api/files/24933283-642a-4ee9-802a-6e7e03afb877/Saccharomyces_cerevisiae.gff

  - title: '<b>Import the reference genome</b>'
    element: '#btn-start'
    content: 'Multiple datasets can be imported.<br /><br />
Click <b>Next</b> to start the upload of the reference genome.<br />'
    placement: top
    postclick:
      - '#btn-start'
      - '#btn-close'

  - title: '<b>Import the reference genome</b>'
    element: '#right'
    content: 'The reference genome is uploading in your history.<br /><br />
Uploaded datasets are available as soon as their entries turn green.<br /><br />
Click <b>Next</b> to start the analysis of the reference genome.<br />'
    placement: left

  - title: '<b>Best practice :)</b>'
    element: '#right'
    content: 'Are your datasets named with meaningful names?<br /><br />
Rename your datasets:<br />
- Click on the pencil icon on the dataset entry you want to analyse<br />
- Modify the name in the first box<br />
- Click <b>Save</b>.<br /><br />
Click <b>Next</b> to resume the analysis once you are done.<br />'
    placement: left

  - title: '<b>Map sequences against a reference genome</b>'
    element: '#tool-search-query'
    content: 'Look for the <b>STAR</b> tool.<br /><br />
STAR is an ultrafast and sensitive RNA-Seq aligner, for mapping sequence reads against a reference genome.<br /><br />
Click <b>Next</b> to load it.<br />'
    placement: right
    textinsert: star
    postclick:
      - >-
        a[href$="/tool_runner?tool_id=toolshed.g2.bx.psu.edu%2Frepos%2Fsarahinraauzeville%2Fstar%2Fsm_star_single_V2%2F1.0.0"]

  - title: '<b>Map sequences against a reference genome</b>'
    element: '#right'
    content: 'With <b>STAR</b>, we want to align all sequence reads from the control and treated samples, against the provided reference genome.<br /><br />
In section <b>Paired or single reads</b>, chose <b>Single reads</b>. Finally, in section <b>Your single read RNA-Seq FASTQ file</b>, click on the <b>Multiple datasets</b> icon, and select all control and treated samples.<br /><br />
If some or all of these samples do not appear in the box, then you need to first convert the missing ones to the correct format, and then reload STAR. Only in this case:<br />
- Click on the pencil icon on the dataset entry you want to analyse<br />
- Select the <b>Datatype</b> tab<br />
- Select <b>fastqcsanger</b><br />
- Click <b>Save</b><br />
- Resume the analysis by clicking again on the STAR tool, in the tool bar on the left. Finally, reselect all control and treated samples.<br /><br />
Click <b>Next</b> to overview the next parameters.<br />'
    placement: left

  - title: '<b>Map sequences against a reference genome</b>'
    element: '#right'
    content: 'In section <b>Genotoul reference genome or your own fasta file</b>, select <b>Your own fasta file</b>, and specify the uploaded reference genome.<br /><br />
If the reference genome does not appear in the box, then you need to first convert it to the correct format, and then reload STAR. Only in this case:<br />
- Click on the pencil icon of the reference genome entry in your history<br />
- Select the <b>Datatype</b> tab<br />
- Select <b>FASTA</b><br />
- Click <b>Save</b><br />
- Resume the analysis by clicking again on the STAR tool, in the tool bar on the left. Finally, reselect all control and treated samples, as well as the reference genome.<br /><br />
Click <b>Next</b> to overview the next parameters.<br />'
    placement: left

  - title: '<b>Map sequences against a reference genome</b>'
    element: '#right'
    content: 'In section <b>Your own GTF file</b>, select the gene model GFF entry from your history.<br /><br />
If the gene model does not appear in the box, then you need to first convert it to the correct format, and then reload STAR. Only in this case:<br />
- Click on the pencil icon of the gene model entry in your history<br />
- Select the <b>Datatype</b> tab<br />
- Select <b>GTF</b><br />
- Click <b>Save</b><br />
- Resume the analysis by clicking again on the STAR tool, in the tool bar on the left. Finally, reselect all control and treated samples, the reference genome, and the gene model.<br /><br />
Click <b>Next</b> to overview the next parameters.<br />'
    placement: left

  - title: '<b>Map sequences against a reference genome</b>'
    element: '#right'
    content: 'For this operation, we will use all default settings for the remaining parameters. However, if you want to know more about their meaning, you can read the STAR manual that is provided below.<br /><br />
Click <b>Next</b> to execute.<br />'
    placement: left
    postclick:
      - '#execute'

  - title: '<b>Map sequences against a reference genome</b>'
    element: '#right'
    content: 'STAR processing has begun, and the results are loading in your history.<br /><br />
Results are available as soon as their entries turn green.<br /><br />
Click <b>Next</b> to overview your data.<br />'
    placement: left

  - title: '<b>Map sequences against a reference genome</b>'
    element: ''
    content: '<b>TODO: explain what is happening in the background</b>.<br /><br />
If the aligning and mapping processing has finished, click <b>Next</b> to analyse the overall gene expression.<br />'

  - title: '<b>Visualise the quality of the RNA-Seq experiment</b>'
    element: ''
    content: 'Now that the processed input datasets have been aligned and mapped against the provided reference genome, we can visualise the quality of the mapped reads.<br /><br />
<b>TODO: provide a complete motivation of why this is desired</b>.<br /><br />
Click <b>Next</b> to start this process.'
    placement: ''

  - title: '<b>Visualise the quality of the RNA-Seq experiment</b>'
    element: '#tool-search-query'
    content: 'Look for the <b>RSeQC</b> tool (<b>Read GC</b>).<br /><br />
RSeQC is a quality control tool for RNA-Seq experiments.<br />
<b>TODO: more on this tool</b>.<br /><br />
Here we use <b>RSeQC</b> to <b>TODO: explain the practical application within this context</b>.<br /><br />
Click <b>Next</b> to load it.<br />'
    placement: right
    textinsert: rseqc
    postclick:
      - >-
        a[href$="/tool_runner?tool_id=toolshed.g2.bx.psu.edu%2Frepos%2Fnilesh%2Frseqc%2Frseqc_bam_stat%2F2.6.4"]
        .tool-old-link

  - title: '<b>Visualise the quality of the RNA-Seq experiment</b>'
    element: '#left'
    content: 'In the section <b>Input .bam/.sam file</b>, click on the <b>Multiple datasets</b> icon to select multiple inputs. Finally, select all generated BAM files.<br /><br />
In this analysis step, we will use all default settings for the present tool. However, to adjust its parameters, you can read the manual that is provided below its box.<br /><br />
Click <b>Next</b> to execute.<br />'
    placement: left
    postclick:
      - '#execute'

  - title: '<b>Visualise the quality of the RNA-Seq experiment</b>'
    element: '#right'
    content: 'RSeQC processing has begun, and the results are loading in your history.<br /><br />
Results are available as soon as their entries turn green.<br /><br />
Click <b>Next</b> to overview your data.<br />'
    placement: left

  - title: '<b>Visualise the quality of the RNA-Seq experiment</b>'
    element: '#right'
    content: 'RSeQC generates a table with the percentage of CG content and read counts (<b>xls</b> output), and a plot of the GC contentent of the aligned and mapped samples (<b>pdf</b> output).<br /><br />
While the former can be used for further downstream analysis, the latter can be used as a publication-ready plot for the GC content of the samples.<br /><br />
Click on the eye icon of the <b>pdf</b> report of RSeQC to understand its output, then click <b>Next</b> to review the properties of your data.<br />'
    placement: left

  - title: '<b>Visualise the quality of the RNA-Seq experiment</b>'
    element: '#left'
    content: '<b>TODO: explanation of the graph</b>'
    placement: left

  - title: '<b>Map sequences against a reference genome</b>'
    element: ''
    content: 'The aligning and mapping of sequences against a reference genome phase has been completed.<br />'

