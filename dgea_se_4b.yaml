id: dgea_se_4b
name: 'Differential Gene Expression Analysis'
description: 'Differential gene expression analysis using HTSeq-count and DESeq2'
title_default: 'Differential Gene Expression Analysis'
steps:
  - title: '<b>Outline</b>'
    element: '#masthead:visible'
    content: 'In this tour, we will carry out transcript quantification, and differential gene expression analysis from mapped RNA-Seq data.<br>
Here, we will leverage on two tools:<br>
- <b>HTSeq-count</b>, to count the number of reads overlapping with predetermined genomic features<br>
- <b>DESeq2</b>, to assess the level of gene expression.<br>
Prior, the inference of the experiment strandness will help you to parameterize the mentioned tools.<br>
Here, we will leverage on <b>RSeQC</b>'
    placement: bottom

  - title: '<b>Infer experiment strandness</b>'
    element: '#tool-search-query:visible'
    content: 'Search for the <b>Text reformatting with awk</b> tool.<br>
Awk is a programming langugae which can be easily applied on data files to e.g. parse, alter and reformat column wise values.<br>
In the following steps, the first 1000 positive and first 1000 negative strand encoded exons will be extracted from the annotation and stored in BED format - necessary for experiment inference.'
    placement: right
    textinsert: text reformatting awk
    postclick:
      - >-
        a[href$="/tool_runner?tool_id=toolshed.g2.bx.psu.edu%2Frepos%2Fbgruening%2Ftext_processing%2Ftp_awk_tool%2F1.1.1"]

  - title: '<b>Infer experiment strandness</b>'
    element: '[tour_id="infile"] .btn-group.ui-radiobutton > :nth-child(2):visible'
    content: 'Switch to multiple dataset view.'
    placement: bottom
    onnextclick:
      - '[tour_id="infile"] .btn-group.ui-radiobutton > :nth-child(2):visible'



  - title: '<b>Infer experiment strandness</b>'
    element: '[tour_id="infile"] .ui-select-multiple.ui-select:visible'
    content: 'Select the genome annotation file.'
    placement: bottom
    select:
      - '[tour_id="infile"] .ui-select-multiple.ui-select .select > :nth-last-child(10):visible'



  - title: '<b>Infer experiment strandness</b>'
    element: '[tour_id="code"] .ui-form-field .ui-textarea:visible'
    content: '<h4>Enter: <br><b>!/^#/ && $3=="exon"{if($7=="+"){ p[px++] = $1"\t"$4"\t"$5"\t.\t.\t"$7 }else{ n[nx++] = $1"\t"$4"\t"$5"\t.\t.\t"$7 } if(nx>1000 && px>1000){ exit } } END{ for(i in p){ print p[i] } for(i in n){ print n[i] } }</b></h4>'
    placement: top
    pointer: true
#    textinsert: |
#      !/^#/ && $3=="exon"{if($7=="+"){ p[px++] = $1"\t"$4"\t"$5"\t.\t.\t"$7 }else{ n[nx++] = $1"\t"$4"\t"$5"\t.\t.\t"$7 } if(nx>1000 && px>1000){ exit } } END{ for(i in p){ print p[i] } for(i in n){ print n[i] } }


  - title: '<b>Infer experiment strandness</b>'
    element: '#execute:visible'
    content: 'Execute exon extraction and file conversion.'
    placement: top
    onnextclick:
      - '#execute:visible'

  - title: '<b>Infer experiment strandness</b>'
    element: '#right:visible'
    content: 'Awk processing has begun.'
    placement: left
    onloadwait:
      - element: '#current-history-panel .list-items > :nth-child(1) .name:contains("Text reformatting")'

  - title: '<b>Infer experiment strandness</b>'
    element: '#masthead:visible'
    content: 'Exon extraction has been completed.'
    placement: bottom
    onloadwait:
      - element: '#current-history-panel .list-item.dataset.history-content.state-loading:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-new:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-running:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-queued:visible'
        count: 0

  - title: '<b>Infer experiment strandness</b>'
    element: '#current-history-panel .list-items > :nth-child(1) .primary-actions .edit-btn:visible'
    content: 'Change datatype to BED'
    placement: left
    onnextclick:
      - '#current-history-panel .list-items > :nth-child(1) .primary-actions .edit-btn:visible'
  - title: '<b>Infer experiment strandness</b>'
    element: '#tab-title-text-datatype:visible'
    content: 'Switch to datatypes pane'
    placement: top
    onnextclick:
      - '#tab-title-text-datatype:visible'
  - title: '<b>Infer experiment strandness</b>'
    element: >-
      [tour_id="datatype"] .ui-form-field .ui-select
    content: '<h4>Select: <b>bed</b></h4>'
    placement: top
    pointer: true
  - title: '<b>Infer experiment strandness</b>'
    element: '#submit_datatype:visible'
    content: 'Apply'
    placement: top
    onnextclick:
      - '#submit_datatype:visible'






  - title: '<b>Infer experiment strandness</b>'
    element: '#tool-search-query:visible'
    content: 'Search for the <b>infer experiment</b> tool.<br>
Infer experiment calculates the fractions of forward and inversely mapped reads onto genomic features with known orientation.'
    placement: right
    textinsert: infer experiment
    postclick:
      - >-
        a[href$="/tool_runner?tool_id=toolshed.g2.bx.psu.edu%2Frepos%2Fnilesh%2Frseqc%2Frseqc_infer_experiment%2F2.6.4.1"]


  - title: '<b>Infer experiment strandness</b>'
    element: '[tour_id="mapq"]:visible'
    placement: top
    content: '<h4>Enter: <b>0</b></h4>'
    pointer: true


  - title: '<b>Infer experiment strandness</b>'
    element: '#execute:visible'
    content: 'Execute experiment strandness inference based on one alignment file (mapping).'
    placement: top
    onnextclick:
      - '#execute:visible'

  - title: '<b>Infer experiment strandness</b>'
    element: '#right:visible'
    content: 'Experiment strandness inference has begun.'
    placement: left
    onloadwait:
      - element: '#current-history-panel .list-items > :nth-child(1) .name:contains("Infer Experiment")'

  - title: '<b>Infer experiment strandness</b>'
    element: '#masthead:visible'
    content: 'Experiment strandness inference has been completed.'
    placement: bottom
    onloadwait:
      - element: '#current-history-panel .list-item.dataset.history-content.state-loading:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-new:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-running:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-queued:visible'
        count: 0

  - title: '<b>Infer experiment strandness</b>'
    element: '#current-history-panel .list-items > :nth-child(1) .primary-actions .display-btn:visible'
    content: 'Open Report'
    placement: left
    onnextclick:
      - '#current-history-panel .list-items > :nth-child(1) .primary-actions .display-btn:visible'

  - title: '<b>Infer experiment strandness</b>'
    element: '#masthead:visible'
    content: 'Infer experiment shows fractions of forward and inversely mapped reads on features of known orientation.'
    placement: bottom

  - title: '<b>Infer experiment strandness</b>'
    element: '#iframe-helper:visible'
    placement: bottom
    iframeelement: 'pre:visible'
    content: '<h4><b>Necessary information for upcoming tool parameterization!</b></h4><br>
If both values are ~0.5, then the library was not strand-specific prepared.<br>
If the first value is siginificantly increased, then the library was prepared FR - forward.<br>
If the second value is increased, then the experiment was designed FR - reversely stranded'


  - title: '<b>Counting mapped reads</b>'
    element: '#tool-search-query:visible'
    content: 'Search for the <b>HTSeq-Count</b> tool.<br>
HTSeq-Count calculates the number of reads that have been mapped against the genomic feature of a reference genome. Here, a feature is a positional range on a chromosome, or a union of such ranges, representing exons, genes, promoter regions, etc.'
    placement: right
    textinsert: htseq-count
    postclick:
      - >-
        a[href$="/tool_runner?tool_id=toolshed.g2.bx.psu.edu%2Frepos%2Flparsons%2Fhtseq_count%2Fhtseq_count%2F0.9.1"]

  - title: '<b>Counting mapped reads</b>'
    element: '[tour_id="samfile"] .btn-group.ui-radiobutton > :nth-child(2):visible'
    content: 'Select multiple datasets.'
    placement: top
    onnextclick:
      - '[tour_id="samfile"] .btn-group.ui-radiobutton > :nth-child(2):visible'


  - title: '<b>Counting mapped reads</b>'
    element: '[tour_id="samfile"] .ui-select-multiple.ui-select:visible'
    content: 'Select all mapped control and treated datasets.'
    placement: top
    select:
      - '[tour_id="samfile"] .ui-select-multiple.ui-select .select > :nth-child(n+1):visible'

  - title: '<b>Counting mapped reads</b>'
    element: '[tour_id="gfffile"]:visible'
    content: '<h4><b>Select initially uploaded genome annotation file</b></h4>'
    placement: top
    pointer: true

  - title: '<b>Counting mapped reads</b>'
    element: '[tour_id="stranded"]:visible'
    content: '<h4><b>Select experiment strandness according to previous inference</b></h4>'
    placement: top
    pointer: true

  - title: '<b>Counting mapped reads</b>'
    element: '[tour_id="minaqual"]:visible'
    content: '<h4>Enter: <b>0</b></h4>'
    placement: top
    pointer: true

  - title: '<b>Counting mapped reads</b>'
    element: '#execute:visible'
    content: 'For all remaining parametrisation options, we will use the provided default settings.<br>
However, for further information, please refer to the manual provided below the tool box.'
    placement: top
    postclick:
      - '#execute:visible'

  - title: '<b>Counting mapped reads</b>'
    element: '#right:visible'
    content: 'HTSeq-Count processing has begun, and the results are loading in your history.'
    placement: left
    onloadwait:
      - element: '#current-history-panel .list-items > :nth-child(1) .name:contains("htseq-count")'

  - title: '<b>Counting mapped reads</b>'
    element: '#masthead:visible'
    content: 'Read quantification has been completed.'
    placement: bottom
    onloadwait:
      - element: '#current-history-panel .list-item.dataset.history-content.state-loading:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-new:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-running:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-queued:visible'
        count: 0



  - title: '<b>Differential gene expression analysis</b>'
    element: '#tool-search-query:visible'
    content: 'Search for the <b>DESeq2</b> tool.<br>
DESeq2 applies statistical methods to the genomic features-aligned read counts, to carry out gene expression analysis.'
    placement: right
    textinsert: deseq2
    postclick:
      - >-
        a[href$="/tool_runner?tool_id=toolshed.g2.bx.psu.edu%2Frepos%2Fiuc%2Fdeseq2%2Fdeseq2%2F2.11.40.6"]

  - title: '<b>Differential gene expression analysis</b>'
    element: '#masthead:visible'
    content: 'DESeq2 can handle multiple factors affecting an experiment in parallel. Each factor has at least two disjunct states/levels. For instance, we can describe our experiment in terms of a single treatment factor, which is conditioned by two different healthy states: control, and treated. Thus, we will describe our experiment accordingly. For normalization, DESeq2 takes all factors into account. Result tables will hold fold-changes of the first defined factor and its first two states.'
    placement: bottom

  - title: '<b>Differential gene expression analysis</b>'
    element: '[tour_id="select_data|rep_factorName_0|factorName"]:visible'
    content: '<h4>Enter: <b>treatment</b></h4>'
    pointer: true
    placement: top

  - title: '<b>Differential gene expression analysis</b>'
    element: '[tour_id="select_data|rep_factorName_0|rep_factorLevel_0|factorLevel"]:visible'
    content: '<h4>Enter: <b>treated</b></h4>'
    pointer: true
    placement: top

  - title: '<b>Differential gene expression analysis</b>'
    element: '[tour_id="select_data|rep_factorName_0|rep_factorLevel_0|countsFile"]:visible'
    content: 'Backtrack files and select all datasets corresponding to treated samples'
    placement: top
    select:
      - '[tour_id="select_data|rep_factorName_0|rep_factorLevel_0|countsFile"] .ui-select-multiple.ui-select .select > :nth-child(-n+8):nth-child(even):visible'
    unselect:
      - '[tour_id="select_data|rep_factorName_0|rep_factorLevel_0|countsFile"] .ui-select-multiple.ui-select .select > :nth-child(1):visible'

  - title: '<b>Differential gene expression analysis</b>'
    element: '[tour_id="select_data|rep_factorName_0|rep_factorLevel_1|factorLevel"]:visible'
    content: '<h4>Enter: <b>control</b></h4>'
    pointer: true
    placement: top


  - title: '<b>Differential gene expression analysis</b>'
    element: '[tour_id="select_data|rep_factorName_0|rep_factorLevel_1|countsFile"]:visible'
    content: 'Backtrack files and select all datasets corresponding to control samples'
    placement: top
    select:
      - '[tour_id="select_data|rep_factorName_0|rep_factorLevel_1|countsFile"] .ui-select-multiple.ui-select .select > :nth-child(n+9):nth-child(-n+16):nth-child(even):visible'
    unselect:
      - '[tour_id="select_data|rep_factorName_0|rep_factorLevel_1|countsFile"] .ui-select-multiple.ui-select .select > :nth-child(1):visible'





  - title: '<b>Differential gene expression analysis</b>'
    element: '#execute:visible'
    content: 'For all remaining parametrisation options, we will use the provided default settings.<br>
However, for further information, please refer to the manual provided below the tool box.'
    placement: top
    postclick:
      - '#execute:visible'

  - title: '<b>Differential gene expression analysis</b>'
    element: '#right:visible'
    content: 'DESeq2 processing has begun, and the results are loading in your history.'
    placement: left
    onloadwait:
      - element: '#current-history-panel .list-items > :nth-child(1) .name:contains("DESeq2")'

  - title: '<b>Differential gene expression analysis</b>'
    element: '#masthead:visible'
    content: 'The differential gene expression analysis has been completed.'
    placement: bottom
    onloadwait:
      - element: '#current-history-panel .list-item.dataset.history-content.state-loading:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-new:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-running:visible'
        count: 0
      - element: '#current-history-panel .list-item.dataset.history-content.state-queued:visible'
        count: 0

  - title: '<b>Differential gene expression analysis</b>'
    element: '#masthead:visible'
    content: 'You successfully completed this Galaxy atom.'
    placement: bottom

